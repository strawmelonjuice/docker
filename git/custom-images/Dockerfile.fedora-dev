FROM fedora:42

# Install basic dependencies
RUN dnf update -y && dnf install -y \
    git \
    gcc \
    gcc-c++ \
    make \
    gnupg \
    unzip \
    autoconf \
    automake \
    binutils \
    bison \
    flex \
    gdb \
    glibc-devel \
    libtool \
    pkgconf \
    pkgconf-m4 \
    pkgconf-pkg-config \
    redhat-rpm-config \
    rpm-build \
    rpm-sign \
    strace \
    asciidoc \
    byacc \
    ctags \
    diffstat \
    intltool \
    ltrace \
    patchutils \
    perl-Fedora-VSP \
    perl-generators \
    pesign \
    source-highlight \
    systemtap \
    valgrind \
    cmake \
    ncurses-devel \
    openssl-devel \
    && dnf clean all

# Install mise
RUN curl https://mise.run | sh
ENV PATH="/root/.local/bin:$PATH"

# Install but not activate ('use') default deps via mise.
RUN mise install node@lts
RUN mise install bun@latest
RUN mise install rust@latest
RUN mise install gleam@latest
RUN mise install erlang@27
RUN mise install erlang@28

# Preactivate Node and Bun
RUN mise use -g node@lts
RUN mise use -g bun@latest

# Generate shims
RUN eval "$(mise activate bash --shims)"

# Set up mise to work in non-interactive shells
RUN echo 'eval "$(mise activate bash)"' >> /root/.bashrc
ENV MISE_ACTIVATE=1

# Add the mise shim path ("/root/.local/share/mise/shims") to PATH
ENV PATH="/root/.local/share/mise/shims:$PATH"

# Verify the tools are accessible
RUN node --version && npm --version

WORKDIR /workspace
